<hr />
<h4>Quick Roll</h4>

{{#if this.roll.hasSheet}}
  <div class="form-check mb-2">
    <Input @type="checkbox" @checked={{this.roll.useBuilder}} class="form-check-input" id="cortex-use-builder" />
    <label class="form-check-label" for="cortex-use-builder">Use sheet builder</label>
  </div>
{{/if}}

{{#if this.roll.useBuilder}}
  <div class="mb-3">
    <h5>Prime Sets</h5>
    <div class="row g-2">
      <div class="col-md-4">
        <label class="form-label">Attribute</label>
        <select class="form-select" onchange={{action (mut this.roll.selectedAttribute) value="target.value"}}>
          <option value="">Select Attribute</option>
          {{#each this.roll.cortex.sheet.attributes as |trait|}}
            <option value="{{trait.name}}">{{trait.name}}</option>
          {{/each}}
        </select>
      </div>
      <div class="col-md-2">
        <label class="form-label">Mod</label>
        <select class="form-select" onchange={{action (mut this.roll.attributeMod) value="target.value"}}>
          <option value="">None</option>
          <option value="U">Step Up</option>
          <option value="D">Step Down</option>
        </select>
      </div>
      <div class="col-md-2 d-flex align-items-end">
        <div class="form-check">
          <Input @type="checkbox" @checked={{this.roll.attributeDouble}} class="form-check-input" id="cortex-attr-double" />
          <label class="form-check-label" for="cortex-attr-double">Doubled</label>
        </div>
      </div>

      <div class="col-md-4">
        <label class="form-label">Skill</label>
        <select class="form-select" onchange={{action (mut this.roll.selectedSkill) value="target.value"}}>
          <option value="">Select Skill</option>
          {{#each this.roll.cortex.sheet.skills as |trait|}}
            <option value="{{trait.name}}">{{trait.name}}</option>
          {{/each}}
        </select>
      </div>
      <div class="col-md-2">
        <label class="form-label">Mod</label>
        <select class="form-select" onchange={{action (mut this.roll.skillMod) value="target.value"}}>
          <option value="">None</option>
          <option value="U">Step Up</option>
          <option value="D">Step Down</option>
        </select>
      </div>
      <div class="col-md-2 d-flex align-items-end">
        <div class="form-check">
          <Input @type="checkbox" @checked={{this.roll.skillDouble}} class="form-check-input" id="cortex-skill-double" />
          <label class="form-check-label" for="cortex-skill-double">Doubled</label>
        </div>
      </div>

      <div class="col-md-4">
        <label class="form-label">Distinction</label>
        <select class="form-select" onchange={{action (mut this.roll.selectedDistinction) value="target.value"}}>
          <option value="">Select Distinction</option>
          {{#each this.roll.cortex.sheet.distinctions as |trait|}}
            <option value="{{trait.name}}">{{trait.name}}</option>
          {{/each}}
        </select>
      </div>
      <div class="col-md-2">
        <label class="form-label">Mod</label>
        <select class="form-select" onchange={{action (mut this.roll.distinctionMod) value="target.value"}}>
          <option value="">None</option>
          <option value="U">Step Up</option>
          <option value="D">Step Down</option>
        </select>
      </div>
      <div class="col-md-2 d-flex align-items-end">
        <div class="form-check">
          <Input @type="checkbox" @checked={{this.roll.distinctionDouble}} class="form-check-input" id="cortex-dist-double" />
          <label class="form-check-label" for="cortex-dist-double">Doubled</label>
        </div>
      </div>
    </div>
  </div>

  <div class="mb-3">
    <h5>Extras</h5>
    {{#each this.roll.extraTraits as |trait|}}
      <div class="row g-2 mb-2">
        <div class="col-md-3">
          <select class="form-select" onchange={{action (mut trait.section) value="target.value"}}>
            <option value="resources">Resources</option>
            <option value="signature_assets">Signature Assets</option>
            <option value="powers">Powers</option>
            <option value="temporary_assets">Temporary Assets</option>
            <option value="complications">Complications</option>
            <option value="distinctions">Distinctions</option>
          </select>
        </div>
        <div class="col-md-3">
          <select class="form-select" onchange={{action (mut trait.name) value="target.value"}}>
            <option value="">Select Trait</option>
            {{#if (eq trait.section "resources")}}
              {{#each this.roll.cortex.sheet.resources as |item|}}
                <option value="{{item.name}}">{{item.name}}</option>
              {{/each}}
            {{/if}}
            {{#if (eq trait.section "signature_assets")}}
              {{#each this.roll.cortex.sheet.signature_assets as |item|}}
                <option value="{{item.name}}">{{item.name}}</option>
              {{/each}}
            {{/if}}
            {{#if (eq trait.section "powers")}}
              {{#each this.roll.cortex.sheet.powers as |item|}}
                <option value="{{item.name}}">{{item.name}}</option>
              {{/each}}
            {{/if}}
            {{#if (eq trait.section "temporary_assets")}}
              {{#each this.roll.cortex.sheet.temporary_assets as |item|}}
                <option value="{{item.name}}">{{item.name}}</option>
              {{/each}}
            {{/if}}
            {{#if (eq trait.section "complications")}}
              {{#each this.roll.cortex.sheet.complications as |item|}}
                <option value="{{item.name}}">{{item.name}}</option>
              {{/each}}
            {{/if}}
            {{#if (eq trait.section "distinctions")}}
              {{#each this.roll.cortex.sheet.distinctions as |item|}}
                <option value="{{item.name}}">{{item.name}}</option>
              {{/each}}
            {{/if}}
          </select>
        </div>
        <div class="col-md-2">
          <select class="form-select" onchange={{action (mut trait.mod) value="target.value"}}>
            <option value="">None</option>
            <option value="U">Step Up</option>
            <option value="D">Step Down</option>
          </select>
        </div>
        <div class="col-md-2 d-flex align-items-end">
          <div class="form-check">
            <Input @type="checkbox" @checked={{trait.doubled}} class="form-check-input" />
            <label class="form-check-label">Doubled</label>
          </div>
        </div>
        <div class="col-md-2 d-flex align-items-end">
          <button class="btn btn-outline-danger btn-sm" {{on "click" (fn this.roll.removeExtraTrait trait)}}>Remove</button>
        </div>
      </div>
    {{/each}}
    <button class="btn btn-outline-secondary btn-sm" {{on "click" this.roll.addExtraTrait}}>Add Extra Trait</button>
  </div>
{{else}}
  <div class="row g-2 mb-2">
    <div class="col-md-6">
      <label class="form-label">Dice Pool</label>
      <Input @value={{this.roll.poolString}} class="form-control" placeholder="d8 d10 d6" />
    </div>
  </div>
{{/if}}

<div class="row g-2 mb-2">
  <div class="col-md-3">
    <label class="form-label">Difficulty</label>
    <Input @type="number" @value={{this.roll.difficulty}} class="form-control" />
  </div>
  <div class="col-md-3 d-flex align-items-end">
    <div class="form-check">
      <Input @type="checkbox" @checked={{this.roll.keepExtra}} class="form-check-input" id="cortex-keep-extra" />
      <label class="form-check-label" for="cortex-keep-extra">Keep 3rd die</label>
    </div>
  </div>
</div>

{{#unless this.roll.useModal}}
  <button class="btn btn-primary btn-sm" {{on "click" this.roll.rollDice}}>Roll</button>
{{/unless}}

{{#if this.roll.rollResult}}
  <div class="mt-3">
    <div><b>Total:</b> {{this.roll.rollResult.total}}</div>
    <div><b>Effect Die:</b> {{this.roll.rollResult.effect_die}}</div>
    {{#if this.roll.rollResult.extra_die}}
      <div><b>Extra Die:</b> {{this.roll.rollResult.extra_die}}</div>
    {{/if}}
    {{#if this.roll.rollResult.difficulty}}
      <div><b>Difficulty:</b> {{this.roll.rollResult.difficulty}}</div>
    {{/if}}
    <div>
      <b>Success:</b>
      {{#if this.roll.rollResult.success}}Yes{{else}}No{{/if}}
      {{#if this.roll.rollResult.heroic}} (Heroic){{/if}}
    </div>
    <div class="mt-2">
      <b>Rolls:</b>
      {{#each this.roll.rollResult.rolls as |r|}}
        <span class="me-2">{{r.value}}(d{{r.die}})</span>
      {{/each}}
    </div>
    {{#if this.roll.rollResult.hitches.length}}
      <div class="mt-1"><b>Hitches:</b> {{this.roll.rollResult.hitches}}</div>
    {{/if}}
  </div>
{{/if}}
